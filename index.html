<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <title>ClearKey JSON API</title>
    <style>
        body { font-family: monospace; background: #121212; color: #00ff00; padding: 20px; word-wrap: break-word; }
        pre { white-space: pre-wrap; }
    </style>
</head>
<body>
    <pre id="json-output">Memproses data...</pre>

    <script>
        function hexToBase64Url(hex) {
            try {
                let bytes = new Uint8Array(hex.match(/.{1,2}/g).map(byte => parseInt(byte, 16)));
                let base64 = btoa(String.fromCharCode.apply(null, bytes));
                return base64.replace(/\+/g, '-').replace(/\//g, '_').replace(/=+$/, '');
            } catch (e) {
                return null;
            }
        }

        function process() {
            // Ambil data dari URL (?keyid=XXX&key=YYY)
            const params = new URLSearchParams(window.location.search);
            const kidHex = params.get('keyid');
            const keyHex = params.get('key');

            if (!kidHex || !keyHex) {
                document.getElementById('json-output').textContent = 
                    'Error: Sila gunakan format URL:\n?keyid=HEX_KID&key=HEX_KEY';
                return;
            }

            const kidB64 = hexToBase64Url(kidHex);
            const keyB64 = hexToBase64Url(keyHex);

            if (!kidB64 || !keyB64) {
                document.getElementById('json-output').textContent = 'Error: Format Hex tidak sah!';
                return;
            }

            const output = {
                "keys": [
                    {
                        "kty": "oct",
                        "kid": kidB64,
                        "k": keyB64
                    }
                ],
                "type": "temporary"
            };

            // Paparkan JSON bersih seperti hasil API
            document.getElementById('json-output').textContent = JSON.stringify(output, null, 2);
        }

        process();
    </script>
</body>
</html>
